<!DOCTYPE HTML>
<html>
    <head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta charset="utf-8">

	<title>FireworksWeb</title>
        
	<style>
         .my_canvas {
             width:100%;
             height:100%;
         }
	 .myPurple  {
	     background-color: purple !important;
	 }
	 .myYellow {
	     background-color: yellow !important;
	 }
	</style>
	
        <script src="/jsrootsys/scripts/JSRootCore.js" type="text/javascript"></script>

        
	<!--
             <script type="text/javascript" src="http://jsroot.gsi.de/dev/scripts/JSRootCore.js"></script>
	     <script type="text/javascript" src="http://xrd-cache-1.t2.ucsd.edu/alja/jsroot/scripts/JSRootCore.js"></script>
	 -->
        
	<!-- Application launch configuration -->
	<script>

         var panel_name = "", panel_handle = null;

	 
	 function ShowOpenui5Panel() {
	     
	     if (!panel_name || !panel_handle || !JSROOT.sap) return false;
	     
	     var panelid = "TopPanelId";
	     var oModel = new JSROOT.sap.ui.model.json.JSONModel({
		 handle: panel_handle   
	     });
	     
	     sap.ui.getCore().setModel(oModel, panelid);
	     
	     JSROOT.sap.ui.xmlview({
		 id: panelid,
		 viewName : "sap.ui.jsroot.view." + panel_name,
		 // layoutData: oLd,
		 // height: "100%"
	     }).placeAt("content");
	     return true;
	     
	     // return oContent.getController(); // return controller of new panel
	 }


	 function InitV7Panel() {
	     
	     var socket_kind = "websocket", use_openui = true;
	     if (JSROOT.GetUrlOption("longpoll")!==null) socket_kind = "longpoll"; else
             if (JSROOT.GetUrlOption("cef3")!==null) socket_kind = "cefquery"; else
             if (JSROOT.GetUrlOption("qt5")!==null) { JSROOT.browser.qt5 = true; socket_kind = "longpoll"; }
	     console.log('Try to open web socket ' +  socket_kind);
	     
	     var handle = new JSROOT.WebWindowHandle(socket_kind);
	     
	     if (window) {
		 window.onbeforeunload = handle.Close.bind(handle);
		 if (JSROOT.browser.qt5) window.onqt5unload = window.onbeforeunload;
	     }
	     // set interim receiver until openui5 panel is not yet ready
	     handle.SetReceiver({                  
		 OnWebsocketOpened: function(handle) {
		     console.log('Connected');
		 },
		 
		 OnWebsocketMsg: function(handle, msg) {
		     console.log('Get message ' + msg + ' handle ' + !!handle);
		     panel_handle = handle;
		     panel_name = (msg.indexOf("SHOWPANEL:")==0) ? msg.substr(10) : "";
		     if (panel_name)
			 ShowOpenui5Panel();
		     else
			 handle.Close();
		 },
		 
		 OnWebsocketClosed: function(handle) {
		     // when connection closed, close panel as well
		     panel_handle = null;
		     if (window) window.close();
		 }
	     });
	     
	     handle.Connect(); // try to connect server
	     
	     JSROOT.AssertPrerequisites('openui5', ShowOpenui5Panel); // load openui5 functionality concurently
	 }
	 
   
	 
	 JSROOT.AssertPrerequisites('2d;openui5', function() {
             // from here you can use  JSROOT.sap variable like

             sap.ui.getCore().loadLibrary("sap.tnt"); 
	     jQuery.sap.registerModulePath("flexiblecolumnlayout", "/currentdir/");	  
	     
	     sap.ui.getCore().attachInit(function() {
		 var app = new sap.m.App({
		     initialPage: "idMain"
		 });
		 
		 var page = sap.ui.view({
		     id: "idMain",
		     viewName: "flexiblecolumnlayout.Main",
		     type: sap.ui.core.mvc.ViewType.XML
		     
	         });
	         app.addPage(page);
	         app.placeAt("content");

	     });
         });
	</script>
    </head>

    <!-- UI Content -->
    <body class="sapUiBody" id="content" role="application">
    </body>

</html>
